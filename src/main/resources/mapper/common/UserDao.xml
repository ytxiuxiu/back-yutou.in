<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="in.yutou.site.common.auth.dao.UserDao">
  <resultMap id="basicResultMap" type="user">
    <id column="user_id" property="userId"/>
    <result column="email" property="email"/>
    <result column="family_name" property="familyName"/>
    <result column="given_name" property="givenName"/>
    <result column="picture_url" property="pictureUrl"/>
    <result column="registered_at" property="registeredAt"/>
    <result column="last_loged_in_at" property="lastLogedInAt"/>
  </resultMap>

  <select id="getUserById" parameterType="string" resultMap="basicResultMap">
    SELECT <include refid="userColumns" />
    FROM users
    WHERE user_id = #{userId}
  </select>

  <insert id="insert" parameterType="user">
    INSERT INTO users (<include refid="userColumns"/>) 
    VALUES (#{userId}, #{email}, #{familyName}, #{givenName}, #{pictureUrl}, #{registeredAt}, #{lastLogedInAt})
  </insert>
  
  <update id="login" parameterType="user">
    UPDATE users
    SET last_loged_in_at = #{lastLogedInAt}
    WHERE user_id = #{userId}
  </update>
  
  <sql id="userColumns">
    user_id, email, family_name, given_name, picture_url, registered_at, last_loged_in_at
  </sql>
</mapper>